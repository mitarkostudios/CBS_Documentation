<h1> Chat Module </h1>

This module allows you to create a chat between different types of players with history. Private, group, server, regional, clan chats. For private chats, it is possible to get a list of dialogues as well as the number of unread messages.

The following settings are available in the editor.

![](https://archbee-image-uploads.s3.amazonaws.com/eJQ_to_S35RjGyX2qhcYY/eBdu9b2FzLnBPw9ZakJSb_image.png)

**Max message length - **The maximum length of a message that the user can send.



### **API Methods**

****

**CBSChat.OnUnreadMessageClear**

Notify when the current user has cleared the conversation from unread messages.

> using CBS;

> using UnityEngine;

>

> public class ChatExample : MonoBehaviour

> {

>     private ICBSChat ChatModule { get; set; }

>

>     private void Start()

>     {

>         ChatModule = CBSModule.Get<CBSChat>();

>

>         ChatModule.OnUnreadMessageClear += OnUnreadMessageClear;

>     }

>

>     private void OnUnreadMessageClear(string userID)

>     {

>         Debug.Log("The user has just cleared the list of unread messages with the user "+ userID);

>     }

> }



**CBSChat.SetServerID**

Sets the server id for the server chat. You need to set this value before initializing the chat.

> using CBS;

> using UnityEngine;

>

> public class ChatExample : MonoBehaviour

> {

>     private ICBSChat ChatModule { get; set; }

>

>     private void Start()

>     {

>         ChatModule = CBSModule.Get<CBSChat>();

>

>         string serverID = "azure_server_en";

>

>         ChatModule.SetServerID(serverID);

>     }

> }



**CBSChat.SetRegion**

Sets the region ID for the regional chat. You need to set this value before initializing the chat. For example "ru", "en".

> using CBS;

> using UnityEngine;

>

> public class ChatExample : MonoBehaviour

> {

>     private ICBSChat ChatModule { get; set; }

>

>     private void Start()

>     {

>         ChatModule = CBSModule.Get<CBSChat>();

>

>         string regionKey = "en";

>

>         ChatModule.SetRegion(regionKey);

>     }

> }



**CBSChat.GetOrCreateChat**

Get chat instance from pre-configured template. Global, Server, Regional.

> using CBS;

> using UnityEngine;

>

> public class ChatExample : MonoBehaviour

> {

>     private ICBSChat ChatModule { get; set; }

>

>     private void Start()

>     {

>         ChatModule = CBSModule.Get<CBSChat>();

>

>         var chatInstance = ChatModule.GetOrCreateChat(ChatTitle.GLOBAL);

>

>         chatInstance.GetMessages(GetChatHistory);

>

>         chatInstance.AddOnNewMessageListener(OnNewMessageAdded);

>     }

>

>     private void GetChatHistory(GetMessagesResult result)

>     {

>         if (result.IsSuccess)

>         {

>             var chatHistory = result.List;

>             foreach (var message in chatHistory)

>             {

>                 Debug.LogFormat("User with name {0} wrote {1}", message.SenderName, message.Body);

>             }

>         }

>     }

>

>     private void OnNewMessageAdded(MessageBody message)

>     {

>         Debug.LogFormat("User {0} wrote a new message {1}", message.SenderName, message.Body);

>     }

> }



**CBSChat.GetOrCreateChatByID**

Get chat instance from custom id. Suitable for creating group chats for example.

> using CBS;

> using UnityEngine;

>

> public class ChatExample : MonoBehaviour

> {

>     private ICBSChat ChatModule { get; set; }

>

>     private void Start()

>     {

>         ChatModule = CBSModule.Get<CBSChat>();

>

>         string groupId = "your group id";

>

>         var chatInstance = ChatModule.GetOrCreateChatByID(groupId);

>

>         chatInstance.GetMessages(GetChatHistory);

>

>         chatInstance.AddOnNewMessageListener(OnNewMessageAdded);

>     }

>

>     private void GetChatHistory(GetMessagesResult result)

>     {

>         if (result.IsSuccess)

>         {

>             var chatHistory = result.List;

>             foreach (var message in chatHistory)

>             {

>                 Debug.LogFormat("User with name {0} wrote {1}", message.SenderName, message.Body);

>             }

>         }

>     }

>

>     private void OnNewMessageAdded(MessageBody message)

>     {

>         Debug.LogFormat("User {0} wrote a new message {1}", message.SenderName, message.Body);

>     }

> }



**CBSChat.GetOrCreateChatWithUser**

Get private chat instance from custom id. Suitable for private chats, from lists of unread messages.

> using CBS;

> using UnityEngine;

>

> public class ChatExample : MonoBehaviour

> {

>     private ICBSChat ChatModule { get; set; }

>

>     private void Start()

>     {

>         ChatModule = CBSModule.Get<CBSChat>();

>

>         string profileId = "some profile id";

>

>         var chatInstance = ChatModule.GetOrCreateChatWithUser(profileId);

>

>         chatInstance.GetMessages(GetChatHistory);

>

>         chatInstance.AddOnNewMessageListener(OnNewMessageAdded);

>     }

>

>     private void GetChatHistory(GetMessagesResult result)

>     {

>         if (result.IsSuccess)

>         {

>             var chatHistory = result.List;

>             foreach (var message in chatHistory)

>             {

>                 Debug.LogFormat("User with name {0} wrote {1}", message.SenderName, message.Body);

>             }

>         }

>     }

>

>     private void OnNewMessageAdded(MessageBody message)

>     {

>         Debug.LogFormat("User {0} wrote a new message {1}", message.SenderName, message.Body);

>     }

> }



**CBSChat.GetUserDialogList**

Get a list of the current player's conversations with whom there was previously a private conversation.

> using CBS;

> using UnityEngine;

>

> public class ChatExample : MonoBehaviour

> {

>     private ICBSChat ChatModule { get; set; }

>

>     private void Start()

>     {

>         ChatModule = CBSModule.Get<CBSChat>();

>

>         ChatModule.GetUserDialogList(OnGetDialogList);

>     }

>

>     private void OnGetDialogList(GetDialogListResult result)

>     {

>         if (result.IsSuccess)

>         {

>             var dialogs = result.Dialogs;

>             foreach (var dialog in dialogs)

>             {

>                 Debug.Log("Dialog with " + dialog.UserName);

>             }

>         }

>     }

> }



**CBSChat.ClearUnreadMessageWithUser**

Clears the list of unread messages with a specific user.

> using CBS;

> using UnityEngine;

>

> public class ChatExample : MonoBehaviour

> {

>     private ICBSChat ChatModule { get; set; }

>

>     private void Start()

>     {

>         ChatModule = CBSModule.Get<CBSChat>();

>

>         string profileID = "some profile id";

>

>         ChatModule.ClearUnreadMessageWithUser(profileID, OnUnreadMessageClear);

>     }

>

>     private void OnUnreadMessageClear(ClearUnreadMessageResult result)

>     {

>         if (result.IsSuccess)

>         {

>             Debug.Log("The user has just cleared the list of unread messages with the user ");

>         }

>     }

> }



**Send new Message**

> using CBS;

> using UnityEngine;

>

> public class ChatExample : MonoBehaviour

> {

>     private ICBSChat ChatModule { get; set; }

>

>     private void Start()

>     {

>         ChatModule = CBSModule.Get<CBSChat>();

>

>         var chatInstance = ChatModule.GetOrCreateChat(ChatTitle.GLOBAL);

>

>         string meesageText = "my message body";

>

>         var messageBody = MessageBody.SimpleFromText(meesageText);

>

>         chatInstance.SendMessage(messageBody, OnMessageSent);

>     }

>

>     private void OnMessageSent(SendMessageResult result)

>     {

>         if (result.IsSuccess)

>         {

>             Debug.Log("You have successfully sent your message");

>         }

>     }

> }

